{{ if .Values.install.logCollector -}}
apiVersion: cluster.appdynamics.com/v1alpha1
kind: LogCollector
metadata:
  name: {{ printf "%s-%s" .Release.Name "appdynamics-log-collector" | trunc 63 }}
  namespace: {{ .Release.Namespace }}
spec:
  {{- template "podConfigs" .Values.logCollectorPod }}

  serviceAccountName: {{ .Values.logCollectorServiceAccount}}

  {{ with .Values.global.tls.appdCollectors -}}
  mTLS:
    enabled: {{ .enabled | quote }}
    {{ if .enabled -}}
    secretName: {{ required "A valid secret name entry required!" .secret.secretName }}
    secretKeys:
      caCert: {{ .secret.secretKeys.caCert }}
      tlsCert: {{ .secret.secretKeys.tlsCert }}
      tlsKey: {{ .secret.secretKeys.tlsKey }}
    {{- end }}
  {{- end }}

  {{ if .Values.logCollectorConfig.filebeatYaml -}}
  filebeatYaml: {{ .Values.logCollectorConfig.filebeatYaml | quote }}

  {{ else -}}
  container:
  {{ toYaml .Values.logCollectorConfig.container | nindent 4 }}
  {{- end}}
{{- end }}